<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z-Taxi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .logo { font-size: 30px; font-weight: bold; color: #f1c40f; margin-bottom: 20px; }
        select { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 20px; font-size: 16px; }
        .order-btn { width: 100%; padding: 15px; background: #f1c40f; border: none; border-radius: 12px; font-weight: bold; font-size: 18px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <div class="logo">Z-Taxi ğŸš–</div>
        <p>Qayerga borasiz?</p>
        <select id="destination">
            <option value="Markaziy Shifoxona">ğŸ¥ Markaziy Shifoxona</option>
            <option value="Dehqon Bozori">ğŸ›’ Dehqon Bozori</option>
            <option value="Temir yo'l bekati">ğŸš‰ Temir yo'l bekati</option>
            <option value="Boshqa joy">â“ Boshqa / Qo'ng'iroq</option>
        </select>
        <button class="order-btn" onclick="sendOrder()">TAKSI CHAQIRISH</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        async function sendOrder() {
            const dest = document.getElementById('destination').value;
            const user = tg.initDataUnsafe?.user;
            const userName = user ? user.first_name : "Mijoz";
            
            // âš ï¸ DIQQAT: O'zingizning ID raqamingizni bu yerga to'g'ri qo'ying!
            const token = "8247825967:AAHfSd1ttkxZoBDj8nmZqKvjaGyGPvTQzqq";
            const chat_id = "-1003219641318"; 

            navigator.geolocation.getCurrentPosition(async (pos) => {
                const mapLink = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                const text = `ğŸš– **YANGI BUYURTMA!**\n\nğŸ“ Manzil: ${dest}\nğŸ‘¤ Mijoz: ${userName}\nğŸ“ Lokatsiya: [Xaritada ko'rish](${mapLink})`;

                const url = `https://api.telegram.org/bot${token}/sendMessage`;
                
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: chat_id,
                            text: text,
                            parse_mode: 'Markdown'
                        })
                    });

                    const result = await response.json();
                    if (result.ok) {
                        alert("Muvaffaqiyatli! Guruhni tekshiring.");
                        tg.close();
                    } else {
                        alert("Xato: " + result.description);
                    }
                } catch (e) {
                    alert("Server bilan aloqa uzildi: " + e.message);
                }
            }, (err) => {
                alert("GPS xatosi: Iltimos, joylashuvga ruxsat bering!");
            });
        }
    </script>
</body>
</html>
